import{_ as K}from"./AppDateTimePicker.vue_vue_type_style_index_0_lang-c0c4cc5e.js";import{_ as O}from"./SnackBar.vue_vue_type_script_setup_true_lang-1315b352.js";import{d as Q,l as c,aG as W,r as E,o as d,c as i,q as e,w as t,a1 as A,s as a,a7 as x,aJ as X,b as B,a6 as $,n as r,aK as v,Y as m,ae as y,af as f,aH as j,U as N,F as h,a as C,aL as Z,y as p,V as ee,P as G,$ as P,aM as te,aa as D}from"./main-27bf03b5.js";import{V as I}from"./VCombobox-2660c3a9.js";import"./VSnackbar-45528893.js";import"./filter-85954aca.js";const ae=r("h6",{class:"text-h6"}," Filter ",-1),le={class:"gap-x-2 mt-2"},oe={class:"d-flex justify-end"},ne={class:"text-h6"},se=r("th",null," Age Range ",-1),ge=Q({__name:"count",setup(re){const g=c(!0),w=c([]),T=c(null),_=c(),V=c(),b=c(),s=c({barangay:"",dateFrom:new Date(new Date().setFullYear(new Date().getFullYear()-1)),dateTo:new Date,selectedLookup:[],selectedIndicators:[],ageRange:[{from:0,to:5},{from:6,to:10},{from:11,to:15},{from:16,to:20},{from:21,to:25},{from:26,to:30},{from:31,to:35},{from:36,to:40}]}),L=c([]),S=c([]),Y=async()=>{try{const o=await D.get("/api/lookup");L.value=o.data}catch(o){console.error("Error fetching data:",o)}},J=o=>{s.value.selectedLookup=o,S.value=o.lookup_list,s.value.selectedIndicators=[],b.value=void 0},M=async()=>{try{const o=await D.get("/api/report/custom",{params:s.value});console.log(o.data),b.value=o.data,g.value=!1,T.value.show("success","Generate Finished")}catch(o){T.value.show("error","Please contact you administrator"),console.log(o)}},q=o=>{let l="data:text/csv;charset=utf-8,";return l+="Age Range,"+o[0].result.map(u=>u.indicator).join(",")+`\r
`,o.forEach(u=>{const k=[u.ageRange];u.result.forEach(F=>{k.push(F.count)}),l+=k.join(",")+`\r
`}),l},z=()=>{const o=q(b.value),l=encodeURI(o),u=document.createElement("a");u.setAttribute("href",l),u.setAttribute("download","custom_report.csv"),document.body.appendChild(u),u.click()},U=JSON.parse(localStorage.getItem("userData")),H=async()=>{try{const o=await D.get("/api/barangays");w.value=o.data.map(l=>l.barangay)}catch(o){console.error("Error fetching data:",o)}};return W(()=>{U.role==="admin"?H():w.value=[U.barangay],Y()}),(o,l)=>{const u=K,k=E("VText"),F=E("Button");return d(),i("div",null,[e(P,null,{default:t(()=>[e(A,{class:"d-flex justify-space-between align-center",onClick:l[0]||(l[0]=n=>g.value=!a(g))},{default:t(()=>[ae,e(x,{variant:"text",icon:a(g)?"mdi-chevron-up":"mdi-chevron-down"},null,8,["icon"])]),_:1}),e(X,null,{default:t(()=>[a(g)?(d(),B($,{key:0,class:"d-flex flex-column gap-y-3"},{default:t(()=>[r("div",null,[e(v,{class:"mb-3"},{default:t(()=>[m(" Select Barangay ")]),_:1}),e(y,null,{default:t(()=>[e(f,null,{default:t(()=>[e(I,{modelValue:a(s).barangay,"onUpdate:modelValue":l[1]||(l[1]=n=>a(s).barangay=n),items:a(w),clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1})]),r("div",null,[e(v,{class:"mb-3"},{default:t(()=>[m(" Date Range: ")]),_:1}),e(y,null,{default:t(()=>[e(f,{cols:"12",md:"6"},{default:t(()=>[e(u,{label:"Date From",modelValue:a(s).dateFrom,"onUpdate:modelValue":l[2]||(l[2]=n=>a(s).dateFrom=n)},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(u,{modelValue:a(s).dateTo,"onUpdate:modelValue":l[3]||(l[3]=n=>a(s).dateTo=n),label:"Date To"},null,8,["modelValue"])]),_:1})]),_:1})]),r("div",null,[e(y,null,{default:t(()=>[e(f,{cols:"12",md:"6"},{default:t(()=>[e(v,{class:"mb-3"},{default:t(()=>[m(" Select Lookup ")]),_:1}),e(y,null,{default:t(()=>[e(f,null,{default:t(()=>[e(I,{items:a(L),"item-title":"lookup_name","onUpdate:modelValue":J},null,8,["items"])]),_:1})]),_:1})]),_:1}),e(f,null,{default:t(()=>[e(v,{class:"mb-3"},{default:t(()=>[m(" Select Indicators ")]),_:1}),e(I,{modelValue:a(s).selectedIndicators,"onUpdate:modelValue":l[4]||(l[4]=n=>a(s).selectedIndicators=n),items:a(S),"item-title":"description","item-value":"lookup_key",disabled:!(a(S).length>0),multiple:"",chips:"",clearable:""},null,8,["modelValue","items","disabled"])]),_:1})]),_:1})]),r("div",null,[e(v,{class:"mb-3"},{default:t(()=>[m(" Select Age: ")]),_:1}),e(y,null,{default:t(()=>[e(f,null,{default:t(()=>[e(j,{label:"From",modelValue:a(_),"onUpdate:modelValue":l[5]||(l[5]=n=>N(_)?_.value=n:null),type:"number"},null,8,["modelValue"])]),_:1}),e(f,{class:"d-flex flex-row align-center gap-x-4"},{default:t(()=>[e(j,{label:"To",modelValue:a(V),"onUpdate:modelValue":l[6]||(l[6]=n=>N(V)?V.value=n:null),type:"number"},null,8,["modelValue"]),e(x,{icon:"mdi-plus",onClick:l[7]||(l[7]=n=>o.addAndSortByFrom(a(_),a(V))),disabled:!(a(_)>0&&a(V)>0)},null,8,["disabled"])]),_:1})]),_:1}),r("div",le,[(d(!0),i(h,null,C(a(s).ageRange,(n,R)=>(d(),B(Z,{color:"primary",class:"mx-1 mt-2"},{default:t(()=>[e(k,null,{default:t(()=>[m(p(n.from)+" - "+p(n.to),1)]),_:2},1024),e(F,{class:"d-flex align-center ms-1",onClick:ue=>o.removeElementArray(R)},{default:t(()=>[e(ee,{icon:"mdi-close",style:{"font-size":"0.9rem !important"}})]),_:2},1032,["onClick"])]),_:2},1024))),256))])]),r("div",oe,[e(x,{disabled:!(a(s).barangay&&a(s).selectedIndicators.length>0),onClick:M},{default:t(()=>[m(" Generate ")]),_:1},8,["disabled"])])]),_:1})):G("",!0)]),_:1})]),_:1}),a(b)?(d(),B(P,{key:0,class:"mt-5"},{default:t(()=>[e(A,{class:"d-flex justify-space-between mt-2 mx-1 align-center"},{default:t(()=>[r("h6",ne,p(a(s).selectedLookup.lookup_name),1),e(x,{variant:"outlined",onClick:z},{default:t(()=>[m(" Export ")]),_:1})]),_:1}),e($,null,{default:t(()=>[e(te,null,{default:t(()=>[r("thead",null,[r("tr",null,[se,(d(!0),i(h,null,C(a(s).selectedIndicators,n=>(d(),i("th",{key:n},p(n.description),1))),128))])]),r("tbody",null,[(d(!0),i(h,null,C(a(b),n=>(d(),i("tr",null,[r("td",null,p(n.ageRange),1),(d(!0),i(h,null,C(n.result,R=>(d(),i("td",null,p(R.count),1))),256))]))),256))])]),_:1})]),_:1})]),_:1})):G("",!0),e(O,{ref_key:"SnackBarRef",ref:T},null,512)])}}});export{ge as default};
