import{_ as F}from"./SnackBar.vue_vue_type_script_setup_true_lang-6b326fdf.js";import{d as T,l as p,aG as L,r as I,o as B,b as O,w as l,q as e,$ as h,a6 as J,a4 as G,ae as R,af as m,aH as v,s as a,aI as D,E as N,G as P,n as x,y as _,aJ as Q,a7 as V,Y as w,U as q,aa as k,c as M,P as H,F as W,a1 as X}from"./main-ec2ae718.js";import{V as Y}from"./VForm-0cdb3b2b.js";import{V as Z}from"./VSpacer-fdc2f1cb.js";import{V as z}from"./VDialog-fb016474.js";import{a as ee}from"./avatar-1-3f757947.js";import{V as ae}from"./VDataTable-f624170c.js";import"./VSnackbar-7066dbda.js";import"./filter-48dc3dcf.js";const le=T({__name:"EditUserDialog",emits:["applied"],setup($,{expose:b,emit:f}){const c=p(!1),u=p(!1),g=p(),U=p([]),s=p(!1),S=[{name:"Administrator",value:"admin"},{name:"Brgy. Administrator",value:"brgyAdmin"},{name:"Brgy. Encoder/Enumerator",value:"brgyEncoder"}],o=p({name:"",email:"",username:"",role:null,barangay:null,activation:!1}),r=p({password:"",c_password:""}),d=async()=>{u.value=!0;try{const y=await k.get("/api/barangays");U.value=y.data.map(t=>t.barangay)}catch(y){console.error("Error fetching data:",y)}finally{u.value=!1}},C=async y=>{try{const t=await k.get(`/api/user/${y}`);console.log(t),o.value=t.data,c.value=!0}catch(t){console.log(t)}},A=async()=>{u.value=!0;let y={name:o.value.name,username:o.value.username,email:o.value.email,role:o.value.role,barangay:o.value.barangay};if(r.value.password!="")if(r.value.password==r.value.c_password)y.password=r.value.password;else{g.value.show("error","Please check your password"),u.value=!1;return}try{const t=await k.patch(`/api/user/${o.value.id}`,y);f("applied"),c.value=!1,console.log("User updated successfully:",t)}catch(t){console.error("Error updating user:",t)}finally{u.value=!1}},n=async()=>{u.value=!0;let y={activation:!o.value.activation};try{const t=await k.patch(`/api/user/${o.value.id}`,y);f("applied"),C(o.value.id)}catch(t){console.error("Error updating user:",t)}finally{u.value=!1}},E=y=>{const t={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Manila"};return new Date(y).toLocaleDateString("en-US",t)};return L(()=>{d()}),b({fetchUser:C}),(y,t)=>{const j=I("VCardAction"),K=F;return B(),O(z,{modelValue:a(c),"onUpdate:modelValue":t[11]||(t[11]=i=>q(c)?c.value=i:null)},{default:l(()=>[e(h,{"max-width":"700",class:"mx-auto",style:{width:"100%"},title:"Edit System User"},{default:l(()=>[e(J,null,{default:l(()=>[e(Y,{onSubmit:t[7]||(t[7]=G(()=>{},["prevent"]))},{default:l(()=>[e(R,null,{default:l(()=>[e(m,{cols:"12",md:"6"},{default:l(()=>[e(v,{modelValue:a(o).name,"onUpdate:modelValue":t[0]||(t[0]=i=>a(o).name=i),label:"Name"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:l(()=>[e(v,{modelValue:a(o).username,"onUpdate:modelValue":t[1]||(t[1]=i=>a(o).username=i),label:"Username"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:l(()=>[e(v,{modelValue:a(o).email,"onUpdate:modelValue":t[2]||(t[2]=i=>a(o).email=i),label:"Email"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:l(()=>[e(D,{modelValue:a(o).role,"onUpdate:modelValue":t[3]||(t[3]=i=>a(o).role=i),items:S,"item-title":"name","item-value":"value",label:"Select User Type"},null,8,["modelValue"])]),_:1}),N(e(m,null,{default:l(()=>[e(D,{modelValue:a(o).barangay,"onUpdate:modelValue":t[4]||(t[4]=i=>a(o).barangay=i),label:"Select Barangay",items:a(U)},null,8,["modelValue","items"])]),_:1},512),[[P,a(o).role!="admin"]]),e(m,{cols:"12"},{default:l(()=>[x("div",null," Created: "+_(E(a(o).created_at)),1),x("div",null," Last Updated: "+_(E(a(o).updated_at)),1)]),_:1}),e(m,{cols:"12"},{default:l(()=>[e(Q,null,{default:l(()=>[N(x("div",null,[e(R,null,{default:l(()=>[e(m,{cols:"12",md:"6"},{default:l(()=>[e(v,{modelValue:a(r).password,"onUpdate:modelValue":t[5]||(t[5]=i=>a(r).password=i),label:"Password",error:a(r).password.length<6},null,8,["modelValue","error"])]),_:1}),e(m,{cols:"12",md:"6"},{default:l(()=>[e(v,{modelValue:a(r).c_password,"onUpdate:modelValue":t[6]||(t[6]=i=>a(r).c_password=i),label:"Confirm Password",error:a(r).password!=a(r).c_password},null,8,["modelValue","error"])]),_:1})]),_:1})],512),[[P,a(s)]])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(j,{class:"d-flex justify-center gap-x-3 pb-5 px-5"},{default:l(()=>[e(V,{variant:"outlined",onClick:t[8]||(t[8]=()=>{a(s)?(a(r).password="",a(r).c_password="",s.value=!a(s)):s.value=!a(s)})},{default:l(()=>[w(_(a(s)?"Cancel":"Change password"),1)]),_:1}),e(V,{variant:a(o).activation?"elevated":"outlined",onClick:t[9]||(t[9]=i=>n()),loading:a(u)},{default:l(()=>[w(_(a(o).activation?"Activated":"Activate"),1)]),_:1},8,["variant","loading"]),e(Z),e(V,{type:"submit",loading:a(u),onClick:A},{default:l(()=>[w(" Apply ")]),_:1},8,["loading"]),e(V,{variant:"outlined",type:"button",onClick:t[10]||(t[10]=i=>c.value=!1)},{default:l(()=>[w(" Cancel ")]),_:1})]),_:1})]),_:1}),e(K,{ref_key:"SnackBarRef",ref:g},null,512)]),_:1},8,["modelValue"])}}}),te={class:"d-flex align-center gap-x-3"},oe=["src"],se={class:"mx-auto"},ne=T({__name:"UserTable",setup($,{expose:b}){const f=[{title:"Full Name",key:"name"},{title:"Username",key:"username"},{title:"User Type",key:"type"},{title:"Barangay",key:"barangay"},{title:"Action",key:"action",align:"center"}],c=p([]),u=p(),g=p(),U=JSON.parse(localStorage.getItem("userData")),s=async()=>{try{const o=await k.get("/api/users/all");c.value=o.data.users,console.log(o)}catch(o){console.log(o)}},S=async o=>{try{const r=await k.delete(`/api/user/${o}`);console.log(r),u.value.show("success","Deleted Succesfully"),s()}catch(r){u.value.show("error",r.response.data.message),console.log(r)}};return L(()=>{s()}),b({fetchData:s}),(o,r)=>{const d=I("VText"),C=F,A=le;return B(),M("div",null,[e(a(ae),{headers:f,items:a(c),class:"text-left"},{"item.name":l(({item:n})=>[x("div",te,[x("img",{src:a(ee),style:{width:"2.3rem","border-radius":"8rem"}},null,8,oe),e(d,{class:"text-body-2"},{default:l(()=>[w(_(n.raw.name),1)]),_:2},1024)])]),"item.type":l(({item:n})=>[x("div",null,_(n.raw.role=="admin"?"Administrator":"")+" "+_(n.raw.role=="brgyAdmin"?"Brgy. Administrator":"")+" "+_(n.raw.role=="brgyEncoder"?"Brgy. Encoder/Enumerator":""),1)]),"item.barangay":l(({item:n})=>[w(_(n.raw.barangay),1)]),"item.action":l(({item:n})=>[x("div",se,[e(V,{variant:"text",color:"secondary",density:"compact",icon:"mdi-pencil-outline",onClick:E=>a(g).fetchUser(n.raw.id)},null,8,["onClick"]),a(U).role==="admin"?(B(),O(V,{key:0,variant:"text",color:"secondary",density:"compact",icon:"mdi-delete-outline",onClick:E=>S(n.raw.id)},null,8,["onClick"])):H("",!0)])]),_:1},8,["items"]),e(C,{ref_key:"SnackBarRef",ref:u},null,512),e(A,{ref_key:"EditUserDialogRef",ref:g,onApplied:r[0]||(r[0]=n=>s())},null,512)])}}}),re=T({__name:"AddUserDialog",emits:["submitted"],setup($,{emit:b}){const f=p(!1),c=p(!1),u=p(),g=p([]),U=[{name:"Administrator",value:"admin"},{name:"Brgy. Administrator",value:"brgyAdmin"},{name:"Brgy. Encoder/Enumerator",value:"brgyEncoder"}],s=p({first_name:"",last_name:"",email:"",username:"",password:"",c_password:"",role:null,barangay:null}),S=async()=>{c.value=!0,k.post("/api/auth/register",s.value).then(r=>{console.log(r),s.value={first_name:"",last_name:"",email:"",username:"",password:"",c_password:"",role:null,barangay:null},f.value=!1,b("submitted")}).catch(r=>{u.value.show("error",r.response.data.message),console.log(r)}),c.value=!1},o=async()=>{c.value=!0;try{const r=await k.get("/api/barangays");g.value=r.data.map(d=>d.barangay)}catch(r){console.error("Error fetching data:",r)}finally{c.value=!1}};return L(()=>{o()}),(r,d)=>{const C=I("VCardAction"),A=F;return B(),M(W,null,[e(V,{onClick:d[0]||(d[0]=n=>f.value=!0)},{default:l(()=>[w(" Add User ")]),_:1}),e(z,{modelValue:a(f),"onUpdate:modelValue":d[10]||(d[10]=n=>q(f)?f.value=n:null)},{default:l(()=>[e(h,{"max-width":"700",class:"mx-auto",style:{width:"100%"},title:"Add System User"},{default:l(()=>[e(J,null,{default:l(()=>[e(Y,{onSubmit:G(S,["prevent"])},{default:l(()=>[e(R,null,{default:l(()=>[e(m,{cols:"12",md:"6"},{default:l(()=>[e(v,{modelValue:a(s).first_name,"onUpdate:modelValue":d[1]||(d[1]=n=>a(s).first_name=n),label:"First Name"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:l(()=>[e(v,{modelValue:a(s).last_name,"onUpdate:modelValue":d[2]||(d[2]=n=>a(s).last_name=n),label:"Last Name"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:l(()=>[e(v,{modelValue:a(s).username,"onUpdate:modelValue":d[3]||(d[3]=n=>a(s).username=n),label:"Username"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:l(()=>[e(v,{modelValue:a(s).email,"onUpdate:modelValue":d[4]||(d[4]=n=>a(s).email=n),label:"Email"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:l(()=>[e(v,{modelValue:a(s).password,"onUpdate:modelValue":d[5]||(d[5]=n=>a(s).password=n),label:"Password"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:l(()=>[e(v,{modelValue:a(s).c_password,"onUpdate:modelValue":d[6]||(d[6]=n=>a(s).c_password=n),label:"Confirm Password"},null,8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(D,{modelValue:a(s).role,"onUpdate:modelValue":d[7]||(d[7]=n=>a(s).role=n),items:U,"item-title":"name","item-value":"value",label:"Select User Type"},null,8,["modelValue"])]),_:1}),N(e(m,null,{default:l(()=>[e(D,{modelValue:a(s).barangay,"onUpdate:modelValue":d[8]||(d[8]=n=>a(s).barangay=n),label:"Select Barangay",items:a(g)},null,8,["modelValue","items"])]),_:1},512),[[P,a(s).role!="admin"]])]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(C,{class:"d-flex justify-center gap-x-3 pb-5"},{default:l(()=>[e(V,{type:"submit",onClick:S,loading:a(c)},{default:l(()=>[w(" Submit ")]),_:1},8,["loading"]),e(V,{variant:"outlined",type:"button",onClick:d[9]||(d[9]=n=>f.value=!1)},{default:l(()=>[w(" Cancel ")]),_:1})]),_:1})]),_:1}),e(A,{ref_key:"SnackBarRef",ref:u},null,512)]),_:1},8,["modelValue"])],64)}}}),de=x("h6",{class:"text-h6"},"System User List",-1),_e=T({__name:"index",setup($){const b=p(),f=JSON.parse(localStorage.getItem("userData"));return(c,u)=>{const g=re,U=ne;return B(),M("div",null,[e(h,null,{default:l(()=>[e(X,{class:"mt-1 d-flex"},{default:l(()=>[de,e(Z),e(v,{label:"Search",class:"mx-3",density:"compact",style:{"max-width":"300px"}}),a(f).role=="admin"?(B(),O(g,{key:0,onSubmitted:u[0]||(u[0]=s=>a(b).fetchData())})):H("",!0)]),_:1}),e(J,{class:"text-center"},{default:l(()=>[e(U,{ref_key:"UserTableRef",ref:b},null,512)]),_:1})]),_:1})])}}});export{_e as default};
