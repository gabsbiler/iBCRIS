import{ah as oe,aN as ie,ai as se,aO as re,ax as ce,aA as ve,l as V,ak as K,Z as b,aP as de,aB as fe,aQ as me,aR as R,C as S,aS as $,an as he,aH as j,q as i,F as q,R as be,H as D,S as ye,W as z,aT as xe,aL as ge,aU as ke,Y as Ce,ap as Ve,aV as pe}from"./main-27bf03b5.js";import{m as we,u as _e}from"./filter-85954aca.js";function De(e,m,I){if(m==null)return e;if(Array.isArray(m))throw new Error("Multiple matches is not implemented");return typeof m=="number"&&~m?i(q,null,[i("span",{class:"v-combobox__unmask"},[e.substr(0,m)]),i("span",{class:"v-combobox__mask"},[e.substr(m,I)]),i("span",{class:"v-combobox__unmask"},[e.substr(m+I)])]):e}const Fe=oe()({name:"VCombobox",props:{delimiters:Array,...we({filterKeys:["title"]}),...ie({hideNoData:!0,returnObject:!0}),...se(re({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...ce({transition:!1})},emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,m){var H;let{emit:I,slots:t}=m;const{t:Q}=ve(),y=V(),x=V(!1),g=V(!0),O=V(),T=K(e,"menu"),v=b({get:()=>T.value,set:l=>{var a;T.value&&!l&&((a=O.value)!=null&&a.Î¨openChildren)||(T.value=l)}}),n=V(-1);let E=!1;const W=b(()=>{var l;return(l=y.value)==null?void 0:l.color}),{items:L,transformIn:Y,transformOut:Z}=de(e),{textColorClasses:G,textColorStyles:J}=fe(W),c=K(e,"modelValue",[],l=>Y(pe(l)),l=>{const a=Z(l);return e.multiple?a:a[0]??null}),p=me(),w=V(e.multiple?"":((H=c.value[0])==null?void 0:H.title)??""),s=b({get:()=>w.value,set:l=>{var a;if(w.value=l,e.multiple||(c.value=[R(e,l)]),l&&e.multiple&&((a=e.delimiters)!=null&&a.length)){const r=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));r.length>1&&(r.forEach(h=>{h=h.trim(),h&&C(R(e,h))}),w.value="")}l||(n.value=-1),g.value=!l}});S(w,l=>{E?$(()=>E=!1):x.value&&!v.value&&(v.value=!0),I("update:search",l)}),S(c,l=>{var a;e.multiple||(w.value=((a=l[0])==null?void 0:a.title)??"")});const{filteredItems:A,getMatches:X}=_e(e,L,b(()=>g.value?void 0:s.value)),k=b(()=>c.value.map(l=>L.value.find(a=>e.valueComparator(a.value,l.value))||l)),M=b(()=>e.hideSelected?A.value.filter(l=>!k.value.some(a=>a.value===l.value)):A.value),N=b(()=>k.value.map(l=>l.props.value)),B=b(()=>k.value[n.value]),U=V();function ee(l){E=!0,e.openOnClear&&(v.value=!0)}function le(){e.hideNoData&&!L.value.length||e.readonly||p!=null&&p.isReadonly.value||(v.value=!0)}function ae(l){var h,u;if(e.readonly||p!=null&&p.isReadonly.value)return;const a=y.value.selectionStart,r=N.value.length;if((n.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(v.value=!0),["Escape"].includes(l.key)&&(v.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(g.value=!0),l.key==="ArrowDown"?(h=U.value)==null||h.focus("next"):l.key==="ArrowUp"&&((u=U.value)==null||u.focus("prev")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(n.value<0){l.key==="Backspace"&&!s.value&&(n.value=r-1);return}const o=n.value;B.value&&C(B.value),n.value=o>=r-1?r-2:o}if(l.key==="ArrowLeft"){if(n.value<0&&a>0)return;const o=n.value>-1?n.value-1:r-1;k.value[o]?n.value=o:(n.value=-1,y.value.setSelectionRange(s.value.length,s.value.length))}if(l.key==="ArrowRight"){if(n.value<0)return;const o=n.value+1;k.value[o]?n.value=o:(n.value=-1,y.value.setSelectionRange(0,0))}l.key==="Enter"&&s.value&&(C(R(e,s.value)),s.value="")}}function te(){x.value&&(g.value=!0)}function C(l){if(e.multiple){const a=N.value.findIndex(r=>e.valueComparator(r,l.value));if(a===-1)c.value=[...c.value,l];else{const r=[...c.value];r.splice(a,1),c.value=r}s.value=""}else c.value=[l],w.value=l.title,$(()=>{v.value=!1,g.value=!0})}function ue(l){x.value=!0}function ne(l){var a;l.relatedTarget==null&&((a=y.value)==null||a.focus())}return S(A,l=>{!l.length&&e.hideNoData&&(v.value=!1)}),S(x,l=>{if(l)n.value=-1;else{if(v.value=!1,!e.multiple||!s.value)return;c.value=[...c.value,R(e,s.value)],s.value=""}}),he(()=>{const l=!!(e.chips||t.chip),a=!!(!e.hideNoData||M.value.length||t.prepend||t.append||t["no-data"]),r=c.value.length>0,[h]=j.filterProps(e);return i(j,D({ref:y},h,{modelValue:s.value,"onUpdate:modelValue":[u=>s.value=u,u=>{u==null&&(c.value=[])}],focused:x.value,"onUpdate:focused":u=>x.value=u,validationValue:c.externalValue,dirty:r,class:["v-combobox",{"v-combobox--active-menu":v.value,"v-combobox--chips":!!e.chips,"v-combobox--selecting-index":n.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,appendInnerIcon:e.items.length?e.menuIcon:void 0,readonly:e.readonly,placeholder:r?void 0:e.placeholder,"onClick:clear":ee,"onMousedown:control":le,onKeydown:ae}),{...t,default:()=>i(q,null,[i(be,D({ref:O,modelValue:v.value,"onUpdate:modelValue":u=>v.value=u,activator:"parent",contentClass:"v-combobox__content",eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:te},e.menuProps),{default:()=>[a&&i(ye,{ref:U,selected:N.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:u=>u.preventDefault(),onFocusin:ue,onFocusout:ne},{default:()=>{var u,o,F;return[!M.value.length&&!e.hideNoData&&(((u=t["no-data"])==null?void 0:u.call(t))??i(z,{title:Q(e.noDataText)},null)),(o=t["prepend-item"])==null?void 0:o.call(t),M.value.map(d=>{var _;return((_=t.item)==null?void 0:_.call(t,{item:d,props:D(d.props,{onClick:()=>C(d)})}))??i(z,D({key:d.value},d.props,{onClick:()=>C(d)}),{prepend:f=>{let{isSelected:P}=f;return e.multiple&&!e.hideSelected?i(xe,{modelValue:P,ripple:!1,tabindex:"-1"},null):void 0},title:()=>{var f,P;return g.value?d.title:De(d.title,(f=X(d))==null?void 0:f.title,((P=s.value)==null?void 0:P.length)??0)}})}),(F=t["append-item"])==null?void 0:F.call(t)]}})]}),k.value.map((u,o)=>{var _;function F(f){f.stopPropagation(),f.preventDefault(),C(u)}const d={"onClick:close":F,modelValue:!0,"onUpdate:modelValue":void 0};return i("div",{key:u.value,class:["v-combobox__selection",o===n.value&&["v-combobox__selection--selected",G.value]],style:o===n.value?J.value:{}},[l?t.chip?i(ke,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:u.title}}},{default:()=>{var f;return[(f=t.chip)==null?void 0:f.call(t,{item:u,index:o,props:d})]}}):i(ge,D({key:"chip",closable:e.closableChips,size:"small",text:u.title},d),null):((_=t.selection)==null?void 0:_.call(t,{item:u,index:o}))??i("span",{class:"v-combobox__selection-text"},[u.title,e.multiple&&o<k.value.length-1&&i("span",{class:"v-combobox__selection-comma"},[Ce(",")])])])})])})}),Ve({isFocused:x,isPristine:g,menu:v,search:s,selectionIndex:n,filteredItems:A,select:C},y)}});export{Fe as V};
