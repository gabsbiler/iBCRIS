import{_ as O}from"./AppDateTimePicker.vue_vue_type_style_index_0_lang-c0c4cc5e.js";import{_ as Y}from"./SnackBar.vue_vue_type_script_setup_true_lang-1315b352.js";import{d as P,l as _,aG as q,r as L,o as u,c as i,q as e,w as t,a1 as N,Y as m,a6 as E,$ as F,s as l,n,b as v,a7 as V,P as C,aJ as z,aK as D,ae as U,af as w,aH as I,U as j,F as R,a as T,aL as K,y as d,V as Q,aM as W,aa as A}from"./main-27bf03b5.js";import{V as X}from"./VCombobox-2660c3a9.js";import"./VSnackbar-45528893.js";import"./filter-85954aca.js";const Z=n("h6",{class:"text-h6"}," Filter ",-1),ee={class:"mb-3"},ae={class:"gap-x-2 mt-2"},te={class:"d-flex justify-end gap-x-3"},le=n("th",null," Barangay ",-1),ne=n("th",null,"No. of Households",-1),oe=n("th",null,"Male Count",-1),se=n("th",null,"Female Count",-1),re=n("th",null,"Unkown Count",-1),ue=n("th",null,"Total",-1),de={class:"text-center"},ce=n("div",null," Age ",-1),he=P({__name:"rbi",setup(me){const b=_(!0),B=_([]),x=_(null),y=_(),h=_(),f=_(),r=_({barangay:[],dateFrom:new Date,dateTo:new Date(new Date().setFullYear(new Date().getFullYear()+1)),ageRange:[{from:0,to:5},{from:6,to:10},{from:11,to:15},{from:16,to:20},{from:21,to:25},{from:26,to:30},{from:31,to:35},{from:36,to:40}]}),M=s=>{s>=0&&s<r.value.ageRange.length&&r.value.ageRange.splice(s,1)},G=(s,o)=>{r.value.ageRange.push({from:s,to:o}),r.value.ageRange.sort((g,p)=>g.from-p.from)},H=async()=>{try{const s=await A.get("/api/get-rbi",{params:r.value});f.value=s.data,console.log(s.data),x.value.show("success","Data Fetch Successful")}catch(s){x.value.show("error",s.response.data.message)}},$=JSON.parse(localStorage.getItem("userData")),J=async()=>{try{const s=await A.get("/api/barangays");B.value=s.data.map(o=>o.barangay)}catch(s){console.error("Error fetching data:",s)}};q(()=>{$.role==="admin"?J():B.value=[$.barangay]});const S=async()=>{if(!f.value){x.value.show("error","No data to export!");return}let s=`Barangay,No. of Households,Male Count,Female Count,Unkown Count,Total
`;s+=f.value.map(c=>`${c.barangay},${c.household},${c.male},${c.female},${c.unknown},${c.male+c.female+c.unknown}`).join(`
`);const o=new Blob([s],{type:"text/csv;charset=utf-8"}),g=window.URL.createObjectURL(o),p=document.createElement("a");p.href=g,p.download="rbi-report.csv",p.click(),window.URL.revokeObjectURL(g)};return(s,o)=>{const g=O,p=L("VText"),c=L("Button");return u(),i("div",null,[e(F,{class:"mb-5"},{default:t(()=>[e(N,{class:"mt-2 ms-1"},{default:t(()=>[m(" Generate Registry of Barangay Inhabitants (RBI) ")]),_:1}),e(E,null,{default:t(()=>[m(" This module allows you to generate a formatted report of RBI per barangay. Just select the barangay you want to generate, the date range and the age range. The default age ranges are already defined there but you can still modify if needed. ")]),_:1})]),_:1}),e(F,null,{default:t(()=>[e(N,{class:"d-flex justify-space-between align-center",onClick:o[0]||(o[0]=a=>b.value=!l(b))},{default:t(()=>[Z,n("div",null,[l(b)?C("",!0):(u(),v(V,{key:0,variant:"outlined",disabled:!l(f),onClick:S},{default:t(()=>[m(" Export ")]),_:1},8,["disabled"])),e(V,{variant:"text",icon:l(b)?"mdi-chevron-up":"mdi-chevron-down"},null,8,["icon"])])]),_:1}),e(z,null,{default:t(()=>[l(b)?(u(),v(E,{key:0,class:"d-flex flex-column gap-y-3"},{default:t(()=>[n("div",null,[e(D,{class:"mb-3"},{default:t(()=>[m(" Select Barangay ")]),_:1}),e(U,null,{default:t(()=>[e(w,null,{default:t(()=>[e(X,{modelValue:l(r).barangay,"onUpdate:modelValue":o[1]||(o[1]=a=>l(r).barangay=a),items:l(B),multiple:"",chips:"",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1})]),n("div",null,[e(D,{class:"mb-3"},{default:t(()=>[m(" Date Range: ")]),_:1}),e(U,null,{default:t(()=>[e(w,{cols:"12",md:"6"},{default:t(()=>[e(g,{label:"Date From",modelValue:l(r).dateFrom,"onUpdate:modelValue":o[2]||(o[2]=a=>l(r).dateFrom=a)},null,8,["modelValue"])]),_:1}),e(w,{cols:"12",md:"6"},{default:t(()=>[e(g,{modelValue:l(r).dateTo,"onUpdate:modelValue":o[3]||(o[3]=a=>l(r).dateTo=a),label:"Date To"},null,8,["modelValue"])]),_:1})]),_:1})]),n("div",ee,[e(D,{class:"mb-3"},{default:t(()=>[m(" Select Age: ")]),_:1}),e(U,null,{default:t(()=>[e(w,null,{default:t(()=>[e(I,{label:"From",modelValue:l(y),"onUpdate:modelValue":o[4]||(o[4]=a=>j(y)?y.value=a:null),type:"number"},null,8,["modelValue"])]),_:1}),e(w,{class:"d-flex flex-row align-center gap-x-4"},{default:t(()=>[e(I,{label:"To",modelValue:l(h),"onUpdate:modelValue":o[5]||(o[5]=a=>j(h)?h.value=a:null),type:"number"},null,8,["modelValue"]),e(V,{icon:"mdi-plus",onClick:o[6]||(o[6]=a=>G(l(y),l(h))),disabled:!(l(y)>0&&l(h)>0)},null,8,["disabled"])]),_:1})]),_:1}),n("div",ae,[(u(!0),i(R,null,T(l(r).ageRange,(a,k)=>(u(),v(K,{color:"primary",class:"mx-1 mt-2"},{default:t(()=>[e(p,null,{default:t(()=>[m(d(a.from)+" - "+d(a.to),1)]),_:2},1024),e(c,{class:"d-flex align-center ms-1",onClick:ie=>M(k)},{default:t(()=>[e(Q,{icon:"mdi-close",style:{"font-size":"0.9rem !important"}})]),_:2},1032,["onClick"])]),_:2},1024))),256))])]),n("div",te,[l(b)?(u(),v(V,{key:0,variant:"outlined",disabled:!l(f),onClick:S},{default:t(()=>[m(" Export ")]),_:1},8,["disabled"])):C("",!0),e(V,{onClick:H,disabled:!(l(r).barangay.length>0)},{default:t(()=>[m(" Generate ")]),_:1},8,["disabled"])])]),_:1})):C("",!0)]),_:1})]),_:1}),l(f)?(u(),v(F,{key:0,class:"mt-3"},{default:t(()=>[e(W,null,{default:t(()=>[n("thead",null,[n("tr",null,[le,ne,oe,se,re,ue,(u(!0),i(R,null,T(l(r).ageRange,a=>(u(),i("th",de,[ce,n("div",null,d(a.from)+" - "+d(a.to),1)]))),256))])]),n("tbody",null,[(u(!0),i(R,null,T(l(f),a=>(u(),i("tr",null,[n("td",null,d(a.barangay),1),n("td",null,d(a.household),1),n("td",null,d(a.male),1),n("td",null,d(a.female),1),n("td",null,d(a.unknown),1),n("td",null,d(a.male+a.female+a.unknown),1),(u(!0),i(R,null,T(a.ageRange,k=>(u(),i("td",{key:k},d(k),1))),128))]))),256))])]),_:1})]),_:1})):C("",!0),e(Y,{ref_key:"SnackBarRef",ref:x},null,512)])}}});export{he as default};
