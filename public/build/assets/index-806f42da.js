import{d as M,l as n,aG as z,C as O,r as R,o as x,c as D,q as a,w as t,a1 as K,a7 as B,s,aJ as Q,E as W,n as w,a6 as P,ae as N,af as f,U as y,aI as X,a2 as Z,F as ee,a as ae,b as te,Y as d,y as g,G as le,$ as A,aH as se,aL as oe,V as F,aa as S}from"./main-27bf03b5.js";import{V as ne}from"./VCombobox-2660c3a9.js";import{V as re}from"./VDataTableServer-c056a51d.js";import{V as ie}from"./VSnackbar-45528893.js";import"./filter-85954aca.js";import"./VDataTable-069e871b.js";const de={class:"d-flex gap-y-3 flex-column"},ue=w("div",null," Filters ",-1),ce=w("h1",{class:"text-h6"}," Household List ",-1),me={class:"d-flex px-auto gap-1"},Ve=M({__name:"index",setup(fe){const _=n(!1),U=n(),b=n(!1),C=n(15),H=n([]),E=n(0),V=n(""),u=JSON.parse(localStorage.getItem("userData")),h=n(!1),L=n(),T=n(),k=n([]),c=n(u.role==="admin"?[]:[u.barangay]),m=n("all"),p=n([]),$=[{title:"Record Batch",key:"household_container.name"},{title:"BRGY/PUROK",key:"Barangay"},{title:"SITIO",key:"sitio"},{title:"BSN",key:"BSN"},{title:"HUSN",key:"HUSN"},{title:"HSN",key:"HSN"},{title:"HEAD OF HOUSEHOLD",key:"Head.Lastname"},{title:"COUNT",key:"Count"},{title:"SURVEY STATUS",key:"surveyStatus"},{title:"ACTION",key:"actions"}],I=o=>{L.value=o.message,T.value=o.type,h.value=!0},v=async o=>{b.value=!0;const l=new URLSearchParams({...o,barangays:c.value.join(","),surveyStatus:m.value!=="all"?m.value:"",containers:p.value.join(",")});try{const i=await S.get("/api/household",{params:l});H.value=i.data.data,E.value=i.data.total}catch(i){console.error("Error fetching data:",i)}finally{b.value=!1}},j=async()=>{try{const o=await S.get("/api/container");U.value=o.data}catch(o){console.error("Error fetching data:",o)}},G=async o=>{try{const l=await S.delete("/api/households",{data:{household_id:o}});I({message:"Household successfully deleted",type:"success"}),v()}catch(l){console.error("Error deleting household:",l),I({message:"Error deleting household",type:"error"})}},Y=async()=>{try{const o=await S.get("/api/barangays");k.value=o.data.map(l=>l.barangay)}catch(o){console.error("Error fetching data:",o)}};z(async()=>{u.role==="admin"?await Y():(k.value=[u.barangay],c.value=[u.barangay]),await j()}),O(c,()=>{v()}),O(m,()=>{v()});const q=o=>{const l=p.value.indexOf(o);l===-1?p.value.push(o):p.value.splice(l,1),v()};return(o,l)=>{const i=R("IconBtn"),J=R("RouterLink");return x(),D("section",de,[a(A,null,{default:t(()=>[a(K,{class:"mt-2 d-flex justify-space-between"},{default:t(()=>[ue,a(B,{icon:s(_)?"mdi-chevron-up":"mdi-chevron-down",onClick:l[0]||(l[0]=e=>_.value=!s(_)),variant:"text"},null,8,["icon"])]),_:1}),a(Q,null,{default:t(()=>[W(w("div",null,[a(P,null,{default:t(()=>[a(N,null,{default:t(()=>[a(f,{cols:"12",md:"6"},{default:t(()=>[a(ne,{label:"Selected Barangay",items:s(k),modelValue:s(c),"onUpdate:modelValue":l[1]||(l[1]=e=>y(c)?c.value=e:null),clearable:"",disabled:s(u).role!=="admin",multiple:""},null,8,["items","modelValue","disabled"])]),_:1}),a(f,{cols:"12",md:"6"},{default:t(()=>[a(X,{label:"Survey Status",items:[{status:"Completed",value:!0},{status:"Not Completed",value:!1},{status:"All",value:"all"}],"item-title":"status","item-value":"value",modelValue:s(m),"onUpdate:modelValue":l[2]||(l[2]=e=>y(m)?m.value=e:null)},null,8,["modelValue"])]),_:1}),a(Z),a(f,{cols:"12"},{default:t(()=>[a(N,null,{default:t(()=>[(x(!0),D(ee,null,ae(s(U),e=>(x(),te(f,{key:e},{default:t(()=>[a(B,{block:"",variant:"outlined",color:s(p).includes(e.name)?"primary":"",onClick:r=>q(e.name)},{default:t(()=>[d(g(e.name),1)]),_:2},1032,["color","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})],512),[[le,s(_)]])]),_:1})]),_:1}),a(A,null,{default:t(()=>[a(P,{class:"d-flex flex-wrap gap-4 flex-column"},{default:t(()=>[a(N,null,{default:t(()=>[a(f,{class:"d-flex align-middle"},{default:t(()=>[ce]),_:1}),a(f,{class:"d-flex justify-end"},{default:t(()=>[a(se,{modelValue:s(V),"onUpdate:modelValue":l[3]||(l[3]=e=>y(V)?V.value=e:null),density:"compact",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":"",dense:"",outlined:"",style:{"max-width":"300px","margin-inline":"0.8rem"}},null,8,["modelValue"]),d(" \\ ")]),_:1})]),_:1}),a(s(re),{class:"mt-3","items-per-page":s(C),"onUpdate:itemsPerPage":l[4]||(l[4]=e=>y(C)?C.value=e:null),headers:$,items:s(H),"items-length":s(E),search:s(V),loading:s(b),"onUpdate:options":v},{"item.Count":t(({item:e})=>[d(g(e.raw.household_members.length),1)]),"item.Head.Lastname":t(({item:e})=>[d(g(e.raw.household_members.find(r=>r.head==1)?e.raw.household_members.find(r=>r.head==1).demographic.lastname+", "+e.raw.household_members.find(r=>r.head==1).demographic.firstname+" "+(e.raw.household_members.find(r=>r.head==1).demographic.middlename?e.raw.household_members.find(r=>r.head==1).demographic.middlename:""):"No Assigned Head"),1)]),"item.surveyStatus":t(({item:e})=>[a(oe,{color:e.raw.surveyStatus?"success":"error",class:"font-weight-medium",size:"small"},{default:t(()=>[d(g(e.raw.surveyStatus?"Completed":"Not Completed"),1)]),_:2},1032,["color"])]),"item.actions":t(({item:e})=>[w("div",me,[a(i,{onClick:r=>G(e.raw.id)},{default:t(()=>[a(F,{icon:"mdi-delete-outline"})]),_:2},1032,["onClick"]),a(i,null,{default:t(()=>[a(J,{to:{name:"household-view-id",params:{id:e.raw.id},query:{household_id:e.raw.id}}},{default:t(()=>[a(F,{icon:`
                mdi-information-slab-circle-outline`})]),_:2},1032,["to"])]),_:2},1024)])]),_:1},8,["items-per-page","items","items-length","search","loading"])]),_:1}),a(ie,{modelValue:s(h),"onUpdate:modelValue":l[6]||(l[6]=e=>y(h)?h.value=e:null),location:"top center",variant:"flat",color:s(T)},{actions:t(()=>[a(B,{color:"white",onClick:l[5]||(l[5]=e=>h.value=!1)},{default:t(()=>[d(" Close ")]),_:1})]),default:t(()=>[d(g(s(L))+" ",1)]),_:1},8,["modelValue","color"])]),_:1})])}}});export{Ve as default};
